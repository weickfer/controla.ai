{"createdAt":"2025-09-20T14:35:43.825Z","updatedAt":"2025-09-21T01:17:24.000Z","id":"JG6MPR4iIYPVVTML","name":"relatorio da vergonha","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"60d04883-38d4-4318-8cde-54d689cdf281","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM transactions WHERE user_id = '{{ $json.id }}' AND type = 'expense' AND transaction_date >= CURRENT_DATE - INTERVAL '30 days';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[688,16],"id":"ee42ea5f-e2fe-4b32-985d-e3bd4b0262e6","name":"transa√ß√µes","executeOnce":false,"alwaysOutputData":false,"credentials":{"postgres":{"id":"x2dqZsNOJH1Cx2KL","name":"Supabase"}}},{"parameters":{"operation":"executeQuery","query":"SELECT id FROM users WHERE id = '88048002-2858-49e4-8730-4799cfd43182'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[208,0],"id":"20b56934-cf79-438c-a9d5-acfc12a5f498","name":"Execute a SQL query","credentials":{"postgres":{"id":"x2dqZsNOJH1Cx2KL","name":"Supabase"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[416,0],"id":"318c4b9a-b94d-410a-93ee-4d17e1c5f5b1","name":"Loop Over Items"},{"parameters":{"promptType":"define","text":"={{ $json.data }}","options":{"systemMessage":"=Voc√™ √© um agente financeiro respons√°vel por gerar o Relat√≥rio da Vergonha do usu√°rio.\n\nEsse relat√≥rio tem como objetivo dar um pux√£o de orelha divertido, destacando os maiores e mais repetidos gastos do √∫ltimo m√™s.\n\nüìå Regras obrigat√≥rias de resposta\n\nNunca use formata√ß√£o Markdown incompat√≠vel com WhatsApp\n\nS√≥ utilize:\n\nNegrito para destacar palavras ou trechos importantes\n\nTra√ßos (-) para listar informa√ß√µes\n\nProibido usar: it√°lico, tachado, listas numeradas, blocos de c√≥digo ou qualquer estrutura que n√£o funcione bem no WhatsApp\n\nüß† Comportamento esperado:\n\nAnalise as transa√ß√µes dos √∫ltimos 30 dias, agrupe por categoria, identifique:\n\nCategorias com gastos mais altos\n\nCategorias com maior frequ√™ncia de uso (repeti√ß√£o)\n\nPoss√≠veis excessos que permitam provoca√ß√µes criativas\n\nüí• Par√¢metro: n√≠vel_de_toxicidade\n\n\"forte\" ‚Üí tom direto e √°cido, com humor constrangedor, pegue pesado, mas sem ferir direitos humanos.\n\nExemplo:\nüî¥ n√≠vel_de_toxicidade = \"forte\"\n\nRelat√≥rio da Vergonha ‚Äì Setembro\n\nR$ 640,00 em entregas ‚Äì vai abrir um restaurante delivery?\n\nR$ 220,00 em streaming ‚Äì maratonou a d√≠vida ou a s√©rie?\n\nR$ 180,00 em Uber ‚Äì t√° pagando assinatura do carro alheio?\n\nSeu bolso t√° implorando por socorro. Vai continuar se sabotando ou vai tomar vergonha?"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1312,16],"id":"5b3d3c72-9499-4b39-a8d2-b131b18c3e4f","name":"AI Agent","executeOnce":true},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1168,288],"id":"cf25954e-7d4e-43ad-92a5-218678bfba69","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"cvdQbdKvMTB3Yl5I","name":"OpenAi account"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[896,16],"id":"9298c731-afc4-4335-824c-5dce6cf4ed8f","name":"Aggregate"}],"connections":{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}]]},"Execute a SQL query":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"transa√ß√µes","type":"main","index":0}]]},"transa√ß√µes":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Aggregate":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"20329310-373a-462c-b3db-9bad1e641203","triggerCount":0,"shared":[{"createdAt":"2025-09-20T14:35:43.897Z","updatedAt":"2025-09-20T14:35:43.897Z","role":"workflow:owner","workflowId":"JG6MPR4iIYPVVTML","projectId":"tfGBfzMepNnJG3zL"}],"tags":[]}